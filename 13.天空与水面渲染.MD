# 天空与水面渲染

```C++
//Subshader
Tags { "Queue" = "Background" "RenderType" = "Background" "PreviewType" = "Skybox" }
Cull Back
```


## 天空球旋转与不被剪裁

```C++
 float3 RotateAroundYInDegrees(float3 vertex, float degrees)
{
    float alpha = degrees * UNITY_PI / 180.0;
    float sina, cosa;
    sincos(alpha, sina, cosa);
    float2x2 m = float2x2(cosa, -sina, sina, cosa);
    return float3(mul(m, vertex.xz), vertex.y).xzy;
}

v2f vert (appdata v)
{
    v2f o;
    float3 rotated = RotateAroundYInDegrees(v.vertex, _Rotation);
    o.pos = UnityObjectToClipPos(rotated);
    //不剪裁
    #if UNITY_REVERSED_Z
        o.pos.z = o.pos.w * 0.000001f; 
    #else
        o.pos.z = o.pos.w * 0.999999f; 
    #endif
    return o;
}
```

## 混合法线

```C++
waterNormal = BlendNormals(waterNormal, waterNormal2);
```

## 线性雾方式柔化水面远端

```C++
 //线性雾方式柔化远端
float m_distance = distance(i.worldPos, _WorldSpaceCameraPos);
float m_linefog = clamp((_SpecStartEnd.y - m_distance) / (_SpecStartEnd.y - _SpecStartEnd.x), 0.0, 1.0);
spec_color = spec_color * m_linefog;
```

##  削弱视野远处waterNormal tilling值

```C++
waterNormal.xy = waterNormal.xy / (i.pos.w + 1.0); //剪裁空间下w分量表示与摄像机的距离[0,1]
```