# 晶体渲染

使用两个Pass 第一个pass绘制背面 第二个绘制正面 叠加渲染

使用反射量作为UV采样环境贴图

```C++
//pass1
float3 ase_worldViewDir = UnityWorldSpaceViewDir(WorldPosition);
ase_worldViewDir = normalize(ase_worldViewDir);
float3 worldRefl13 = reflect( -ase_worldViewDir, float3( dot( tanToWorld0, tex2D( _Normal, uv_Normal ).rgb ), dot( tanToWorld1, tex2D( _Normal, uv_Normal ).rgb ), dot( tanToWorld2, tex2D( _Normal, uv_Normal ).rgb ) ) );
float3 WorldReflection25 = worldRefl13;
float4 ReflectionTex0129 = texCUBE( _ReflectionTex, WorldReflection25 );
float4 ReflectionTex231 = texCUBE( _ReflectionTex2, WorldReflection25 );
float4 baseColor35 = ( ReflectionTex0129 * ReflectionTex231 * _Color * _BackStrength );

//pass2
float3 ase_worldViewDir = UnityWorldSpaceViewDir(WorldPosition);
ase_worldViewDir = normalize(ase_worldViewDir);
float3 worldRefl13 = reflect( -ase_worldViewDir, float3( dot( tanToWorld0, tex2D( _Normal, uv_Normal ).rgb ), dot( tanToWorld1, tex2D( _Normal, uv_Normal ).rgb ), dot( tanToWorld2, tex2D( _Normal, uv_Normal ).rgb ) ) );
float3 WorldReflection25 = worldRefl13;
float4 ReflectionTex231 = texCUBE( _ReflectionTex2, WorldReflection25 );
//乘以fresnel 消除中间
float fresnelNdotV16 = dot( ase_worldNormal, ase_worldViewDir );
float fresnelNode16 = ( _FresnelMaskBias + _FresnelMaskScale * pow( 1.0 - fresnelNdotV16, _FresnelMaskPower ) );
float4 FrontColor39 = ( ( ReflectionTex231 + ( ReflectionTex231 * _FrontStrength ) ) * fresnelNode16 );
```


### 将一张图片始终显示贴在模型上 无论什么视角

将顶点转为view Space 减去原点的View Space

加上法线在view Space 可偏移

```C++
float3 objToView7 = mul( UNITY_MATRIX_MV, float4( i.ase_texcoord1.xyz, 1 ) ).xyz;
float3 objToView9 = mul( UNITY_MATRIX_MV, float4( float3(0,0,0), 1 ) ).xyz;
float3 ase_worldNormal = i.ase_texcoord2.xyz;
float3 objToView28 = mul( UNITY_MATRIX_MV, float4( ase_worldNormal, 1 ) ).xyz;
finalColor = tex2D( _TextureSample0, ( ( (( objToView7 - objToView9 )).xy * (_Offset).xy ) + (_Offset).zw + ( _NormalStrength * (objToView28).xy ) ) );
```