05.火焰与消融

## 简单火焰

> 利用噪点图 移动UV 使用step或者smoothstep区分黑白与过渡部分 透明度输出

```C++

void surf( Input i , inout SurfaceOutput o )
{
    o.Emission = _FireColor.rgb;
    float2 uv_FireMask = i.uv_texcoord * _FireMask_ST.xy + _FireMask_ST.zw;
    float2 uv_NoiseMap = i.uv_texcoord * _NoiseMap_ST.xy + _NoiseMap_ST.zw;
    float2 panner59 = ( 1.0 * _Time.y * _UVSpeed + uv_NoiseMap); // 移动UV
    float NoiseMap83 = tex2D( _NoiseMap, panner59 ).r;
    float4 appendResult100 = (float4(( uv_FireMask.x + ( (NoiseMap83*2.0 + -1.0) * _fireShapeNoise ) ) , uv_FireMask.y , 0.0 , 0.0));
    float2 uv_FireRamp = i.uv_texcoord * _FireRamp_ST.xy + _FireRamp_ST.zw;
    //smoothstep
    float smoothstepResult65 = smoothstep( NoiseMap83 , ( NoiseMap83 - _Smooth ) , tex2D( _FireRamp, uv_FireRamp ).r);
    float NoiseUV71 = smoothstepResult65;
    float Opacity95 = ( tex2D( _FireMask, appendResult100.xy ).r * NoiseUV71 );
    o.Alpha = Opacity95;
}
```

## HoudiniVAT
> _bounding由Houdini生成
```C++
_boundingMax("Bounding Max", Float) = 1.072085
_boundingMin("Bounding Min", Float) = -2.653735
_numOfFrames("Number Of Frames", int) = 100
_speed("Speed", Float) = 0.33

v2f vert (appdata v)
{
    v2f o;
    //Houdini顶点动画
    float timeInFrames = ((ceil(frac(-_Time.y * _speed) * _numOfFrames))/_numOfFrames) + (1.0/_numOfFrames);
    float4 texturePos = tex2Dlod(_posTex,float4(v.texcoord1.x, (timeInFrames + v.texcoord1.y), 0, 0)); //第二套UV
    float expand = _boundingMax - _boundingMin;
    texturePos.xyz *= expand;
    texturePos.xyz += _boundingMin;
    texturePos.x *= -1;  //flipped to account for right-handedness of unity
    v.vertex.xyz += texturePos.xzy;  //swizzle y and z because textures are exported with z-up
}

```

## 有方向的溶解或者火焰

使用UV 或者 Ramp图 或者 计算点与世界空间某点距离

```C++
//获取物体中心点世界空间坐标
float3 ObjTransformToWorld = mul(unity_ObjectToWorld, float4( float3( 0,0,0 ), 1 ) ).xyz;
float _dis = clamp(0,1,(i.world_pos.y - (ObjTransformToWorld.y + _zeroStart)));
float dissolveNoise = tex2D(_DissolveNoise, i.uv).r; 
dissolveNoise = smoothstep(dissolveNoise , dissolveNoise - _dissolve ,_dis);
```